<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پنل مدیریت - Vigigames</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        .success { color: #28a745; text-align: center; margin: 20px 0; font-weight: bold; }
        .download-btn {
            background: #ffd700; color: #000; padding: 14px 32px; border: none; border-radius: 50px;
            font-weight: bold; font-size: 1.1rem; cursor: pointer; margin: 30px auto; display: block;
        }
        .download-btn:hover { background: #ffed4e; }
    </style>
</head>
<body class="admin-body">

    <!-- صفحه ورود -->
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <h2>ورود مدیر</h2>
            <div class="input-group">
                <input type="password" id="adminPass" placeholder="رمز عبور" autocomplete="off">
                <button type="button" id="togglePass" onclick="togglePassword()">نمایش</button>
            </div>
            <button class="login-btn" onclick="login()">ورود به پنل</button>
            <p class="error" id="errorMsg" style="display:none;"></p>
        </div>
    </div>

    <!-- پنل مدیریت -->
    <div class="admin-panel container" id="adminPanel" style="display:none;">
        <div class="header-admin">
            <h2>مدیریت پروژه‌ها</h2>
            <div>
                <a href="index.html" class="home-btn">صفحه اصلی</a>
                <button class="logout-btn" onclick="logout()">خروج</button>
            </div>
        </div>

        <!-- فرم اضافه کردن پروژه -->
        <form id="projectForm">
            <input type="text" id="pName" placeholder="نام پروژه" required>
            <textarea id="pDesc" placeholder="توضیحات کامل پروژه..." required></textarea>
            <input type="url" id="pImage" placeholder="لینک مستقیم عکس (مثلاً از imgur.com)" required>
            <select id="pStatus" required>
                <option value="in-progress">در حال ساخت</option>
                <option value="completed">تکمیل شده</option>
                <option value="cancelled">لغو شده</option>
            </select>
            <button type="submit" id="submitBtn">ثبت پروژه</button>
        </form>

        <div class="success" id="successMsg"></div>

        <!-- دکمه دانلود JSON برای آپلود دستی به GitHub -->
        <div style="text-align:center;margin:40px 0;">
            <button type="button" onclick="downloadJSON()" class="download-btn">
                دانلود projects.json (برای نمایش عمومی در سایت)
            </button>
            <p style="color:#aaa;font-size:0.9rem;margin-top:10px;">
                بعد از دانلود، فایل رو در پوشه <code>data/projects.json</code> آپلود کن تا همه ببینن!
            </p>
        </div>

        <h3 style="margin-top:50px;color:#ffd700;">پروژه‌های ثبت شده (در مرورگر شما)</h3>
        <div id="adminProjectsList"></div>

        <div style="text-align:center;margin:60px 0;">
            <a href="index.html" class="home-btn big">بازگشت به صفحه اصلی</a>
        </div>
    </div>

    <!-- اسکریپت اصلی -->
    <script>
        const PASSWORD = "13822";
        let projects = [];
        let editingId = null;

        // بارگذاری از localStorage
        const saved = localStorage.getItem("vigigames_projects");
        if (saved) projects = JSON.parse(saved);

        function togglePassword() {
            const input = document.getElementById("adminPass");
            const btn = document.getElementById("togglePass");
            input.type = input.type === "password" ? "text" : "password";
            btn.textContent = input.type === "password" ? "نمایش" : "مخفی";
        }

        function login() {
            if (document.getElementById("adminPass").value === PASSWORD) {
                document.getElementById("loginScreen").style.display = "none";
                document.getElementById("adminPanel").style.display = "block";
                renderList();
            } else {
                document.getElementById("errorMsg").textContent = "رمز اشتباه است!";
                document.getElementById("errorMsg").style.display = "block";
            }
        }

        function logout() {
            document.getElementById("adminPanel").style.display = "none";
            document.getElementById("loginScreen").style.display = "flex";
            document.getElementById("adminPass").value = "";
            document.getElementById("adminPass").type = "password";
            document.getElementById("togglePass").textContent = "نمایش";
        }

        // دانلود فایل JSON
        function downloadJSON() {
            if (projects.length === 0) {
                alert("هنوز پروژه‌ای اضافه نکردی!");
                return;
            }
            const data = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(projects, null, 2));
            const a = document.createElement("a");
            a.href = data;
            a.download = "projects.json";
            a.click();
            alert("فایل دانلود شد! حالا برو به GitHub و در مسیر data/projects.json آپلودش کن.");
        }

        function renderList() {
            const list = document.getElementById("adminProjectsList");
            if (projects.length === 0) {
                list.innerHTML = "<p style='text-align:center;color:#888;padding:50px;'>هنوز پروژه‌ای اضافه نشده</p>";
                return;
            }
            list.innerHTML = "";
            projects.forEach((p, i) => {
                const statusText = p.status === "completed" ? "تکمیل شده" :
                                 p.status === "in-progress" ? "در حال ساخت" : "لغو شده";
                const color = p.status === "completed" ? "#28a745" :
                             p.status === "in-progress" ? "#ffc107" : "#dc3545";

                list.innerHTML += `
                    <div class="admin-project-item">
                        <img src="${p.image}" onerror="this.src='https://placehold.co/100x100/333/ffd700?text=IMG'" alt="">
                        <div class="info">
                            <strong>${p.name}</strong>
                            <p>${p.desc.substring(0, 80)}...</p>
                            <span class="status-badge" style="background:${color}">${statusText}</span>
                        </div>
                        <div class="actions">
                            <button onclick="editProject(${i})">ویرایش</button>
                            <button onclick="deleteProject(${i})" style="background:#e74c3c;">حذف</button>
                        </div>
                    </div>
                `;
            });
        }

        function editProject(i) {
            const p = projects[i];
            editingId = i;
            document.getElementById("pName").value = p.name;
            document.getElementById("pDesc").value = p.desc;
            document.getElementById("pImage").value = p.image;
            document.getElementById("pStatus").value = p.status;
            document.getElementById("submitBtn").textContent = "بروزرسانی پروژه";
        }

        function deleteProject(i) {
            if (confirm("واقعاً حذف بشه؟")) {
                projects.splice(i, 1);
                localStorage.setItem("vigigames_projects", JSON.stringify(projects));
                renderList();
            }
        }

        // فرم ثبت پروژه
        document.getElementById("projectForm").addEventListener("submit", function(e) {
            e.preventDefault();
            const newProj = {
                name: document.getElementById("pName").value.trim(),
                desc: document.getElementById("pDesc").value.trim(),
                image: document.getElementById("pImage").value.trim() || "https://placehold.co/800x600/222/ffd700?text=VIGIGAMES",
                status: document.getElementById("pStatus").value
            };

            if (!newProj.name || !newProj.desc || !newProj.image) {
                alert("همه فیلدها اجباریه!");
                return;
            }

            if (editingId === null) {
                projects.push(newProj);
            } else {
                projects[editingId] = newProj;
                editingId = null;
                document.getElementById("submitBtn").textContent = "ثبت پروژه";
            }

            localStorage.setItem("vigigames_projects", JSON.stringify(projects));
            renderList();
            document.getElementById("successMsg").textContent = "پروژه با موفقیت ثبت شد!";
            setTimeout(() => document.getElementById("successMsg").textContent = "", 4000);
            e.target.reset();
        });
    </script>
</body>
</html>
