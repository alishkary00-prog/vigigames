const PASSWORD = "13822";
const TOKEN = "غلط"; // ← اینجا توکن رو بذار (مرحله بعدی توضیح میدم)
const REPO = "alishkary00-prog/vigigames";
const FILE_PATH = "data/projects.json";
let projects = [];
let editingId = null;

function login() {
    if (document.getElementById("adminPass").value === PASSWORD) {
        document.getElementById("loginScreen").style.display = "none";
        document.getElementById("adminPanel").style.display = "block";
        loadProjects();
    } else {
        alert("رمز اشتباه!");
    }
}

function loadProjects() {
    fetch(`https://api.github.com/repos/${REPO}/contents/${FILE_PATH}`)
        .then(res => res.json())
        .then(data => {
            const content = JSON.parse(atob(data.content));
            projects = content;
            renderAdminList();
        });
}

function saveToGitHub() {
    const content = btoa(unescape(encodeURIComponent(JSON.stringify(projects, null, 2))));
    
    fetch(`https://api.github.com/repos/${REPO}/contents/${FILE_PATH}`, {
        method: "GET"
    })
    .then(res => res.json())
    .then(data => {
        const sha = data.sha;
        
        return fetch(`https://api.github.com/repos/${REPO}/contents/${FILE_PATH}`, {
            method: "PUT",
            headers: {
                "Authorization": `token ${TOKEN}`,
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                message: "به‌روزرسانی پروژه‌ها",
                content: content,
                sha: sha,
                branch: "main"
            })
        });
    })
    .then(() => {
        alert("پروژه با موفقیت ثبت شد و برای همه دنیا قابل دیدنه!");
        loadProjects();
    });
}

// بقیه توابع (renderAdminList, editProject, deleteProject, فرم) مثل قبل
// فقط در انتهای فرم submit اینو بذار:
document.getElementById("projectForm").addEventListener("submit", e => {
    e.preventDefault();
    const newProj = {
        name: document.getElementById("pName").value,
        desc: document.getElementById("pDesc").value,
        image: document.getElementById("pImage").value,
        status: document.getElementById("pStatus").value
    };

    if (editingId === null) projects.push(newProj);
    else projects[editingId] = newProj;

    saveToGitHub();
    e.target.reset();
    editingId = null;
});
