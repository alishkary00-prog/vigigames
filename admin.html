<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پنل مدیریت - VIGIGAMES</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/style.css">
    <style>
        :root { --neon: #00ffff; --dark: #0d0d1a; --glass: rgba(10,15,40,0.4); }
        body { background:#000; color:#e0f0ff; font-family:'Share Tech Mono',monospace; min-height:100vh; }
        .login-screen { position:fixed; inset:0; background:rgba(0,0,0,0.95); display:flex; align-items:center; justify-content:center; z-index:999; }
        .login-box { background:var(--glass); padding:40px; border-radius:16px; border:1px solid var(--neon); box-shadow:0 0 30px rgba(0,255,255,0.3); text-align:center; backdrop-filter:blur(10px); }
        .login-box h2 { font-family:'Orbitron',sans-serif; font-size:2.5rem; color:var(--neon); margin-bottom:30px; }
        .input-group { position:relative; margin:20px 0; }
        .input-group input { width:100%; padding:14px; background:rgba(255,255,255,0.05); border:1px solid var(--neon); border-radius:8px; color:#fff; font-size:1.1rem; }
        .input-group button { position:absolute; left:10px; top:50%; transform:translateY(-50%); background:none; border:none; color:var(--neon); cursor:pointer; }
        .login-btn { background:var(--neon); color:#000; padding:14px 40px; border:none; border-radius:50px; font-weight:bold; font-size:1.1rem; cursor:pointer; margin-top:20px; box-shadow:0 0 20px rgba(0,255,255,0.5); }
        .error { color:#ff3366; margin-top:15px; display:none; }

        .admin-panel { padding:40px 20px; display:none; }
        .header-admin { display:flex; justify-content:space-between; align-items:center; margin-bottom:40px; flex-wrap:wrap; gap:15px; }
        .header-admin h2 { font-family:'Orbitron',sans-serif; font-size:2.8rem; color:var(--neon); }
        .home-btn, .logout-btn { background:var(--neon); color:#000; padding:10px 25px; border:none; border-radius:50px; font-weight:bold; cursor:pointer; text-decoration:none; display:inline-block; }

        form { background:var(--glass); padding:30px; border-radius:16px; border:1px solid rgba(0,255,255,0.3); backdrop-filter:blur(10px); }
        form input, form textarea, form select { width:100%; padding:14px; margin:15px 0; background:rgba(255,255,255,0.05); border:1px solid var(--neon); border-radius:8px; color:#fff; font-family:inherit; }
        form button { background:var(--neon); color:#000; padding:14px 30px; border:none; border-radius:50px; font-weight:bold; cursor:pointer; }

        .download-section { text-align:center; margin:50px 0; padding:30px; background:var(--glass); border-radius:16px; border:1px solid var(--neon); }
        .download-btn { background:var(--neon); color:#000; padding:16px 40px; border:none; border-radius:50px; font-size:1.2rem; font-weight:bold; cursor:pointer; box-shadow:0 0 30px rgba(0,255,255,0.6); }

        .admin-project-item { display:flex; align-items:center; gap:20px; background:var(--glass); padding:20px; margin:20px 0; border-radius:12px; border:1px solid rgba(0,255,255,0.2); }
        .admin-project-item img { width:100px; height:100px; object-fit:cover; border-radius:8px; }
        .admin-project-item .actions button { margin-left:10px; padding:8px 16px; border:none; border-radius:8px; cursor:pointer; }
        .success { color:#00ff88; text-align:center; font-weight:bold; margin:20px 0; }
    </style>
</head>
<body>

    <!-- صفحه ورود -->
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <h2>ورود مدیر</h2>
            <div class="input-group">
                <input type="password" id="adminPass" placeholder="رمز عبور" autocomplete="off">
                <button type="button" id="togglePass" onclick="togglePassword()">نمایش</button>
            </div>
            <button class="login-btn" onclick="login()">ورود به پنل</button>
            <p class="error" id="errorMsg">رمز اشتباه است!</p>
        </div>
    </div>

    <!-- پنل مدیریت -->
    <div class="container admin-panel" id="adminPanel">
        <div class="header-admin">
            <h2>مدیریت پروژه‌ها</h2>
            <div>
                <a href="../index.html" class="home-btn">صفحه اصلی</a>
                <button class="logout-btn" onclick="logout()">خروج</button>
            </div>
        </div>

        <form id="projectForm">
            <input type="text" id="pName" placeholder="نام پروژه" required>
            <textarea id="pDesc" rows="4" placeholder="توضیحات کامل پروژه..." required></textarea>
            <input type="url" id="pImage" placeholder="لینک مستقیم عکس (مثال: https://i.imgur.com/abc123.jpg)" required>
            <select id="pStatus" required>
                <option value="in-progress">در حال ساخت</option>
                <option value="completed">تکمیل شده</option>
                <option value="cancelled">لغو شده</option>
            </select>
            <button type="submit" id="submitBtn">ثبت پروژه</button>
        </form>

        <div class="success" id="successMsg"></div>

        <!-- دانلود JSON -->
        <div class="download-section">
            <h3 style="color:var(--neon);margin-bottom:20px;">برای نمایش در سایت:</h3>
            <button type="button" onclick="downloadJSON()" class="download-btn">
                دانلود projects.json
            </button>
            <p style="margin-top:15px;color:#99ccff;font-size:0.9rem;">
                فایل دانلود شده را در GitHub → data/projects.json آپلود کن
            </p>
        </div>

        <h3 style="color:var(--neon);margin:50px 0 20px;">پروژه‌های ثبت شده (در مرورگر شما)</h3>
        <div id="adminProjectsList"></div>
    </div>

    <script>
        const PASSWORD = "13822";
        let projects = [];
        let editingId = null;

        // بارگذاری از localStorage
        const saved = localStorage.getItem("vigigames_projects");
        if (saved) projects = JSON.parse(saved);

        function togglePassword() {
            const input = document.getElementById("adminPass");
            const btn = document.getElementById("togglePass");
            if (input.type === "password") { input.type = "text"; btn.textContent = "مخفی"; }
            else { input.type = "password"; btn.textContent = "نمایش"; }
        }

        function login() {
            if (document.getElementById("adminPass").value === PASSWORD) {
                document.getElementById("loginScreen").style.display = "none";
                document.getElementById("adminPanel").style.display = "block";
                renderList();
            } else {
                document.getElementById("errorMsg").style.display = "block";
            }
        }

        function logout() {
            document.getElementById("adminPanel").style.display = "none";
            document.getElementById("loginScreen").style.display = "flex";
            document.getElementById("adminPass").value = "";
            document.getElementById("errorMsg").style.display = "none";
        }

        function downloadJSON() {
            if (projects.length === 0) return alert("ابتدا یک پروژه اضافه کن!");
            const data = JSON.stringify(projects, null, 2);
            const blob = new Blob([data], {type: "application/json"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url; a.download = "projects.json"; a.click();
            document.getElementById("successMsg").textContent = "فایل projects.json دانلود شد! حالا در GitHub آپلود کن.";
            setTimeout(() => document.getElementById("successMsg").textContent = "", 5000);
        }

        function renderList() {
            const list = document.getElementById("adminProjectsList");
            if (projects.length === 0) {
                list.innerHTML = "<p style='text-align:center;color:#6688aa;padding:60px;'>هنوز پروژه‌ای اضافه نشده</p>";
                return;
            }
            list.innerHTML = "";
            projects.forEach((p, i) => {
                const statusText = p.status === "completed" ? "تکمیل شده" : p.status === "in-progress" ? "در حال ساخت" : "لغو شده";
                const color = p.status === "completed" ? "#00ff88" : p.status === "in-progress" ? "#ff0088" : "#666";
                list.innerHTML += `
                    <div class="admin-project-item">
                        <img src="${p.image}" onerror="this.src='https://placehold.co/100x100/111/00ffff?text=IMG'" alt="">
                        <div style="flex:1;">
                            <strong style="color:var(--neon);font-size:1.3rem;">${p.name}</strong>
                            <p style="margin:8px 0;color:#99ccff;">${p.desc.substring(0,100)}...</p>
                            <span style="padding:4px 12px;background:rgba(0,255,255,0.2);color:${color};border-radius:20px;font-size:0.8rem;">${statusText}</span>
                        </div>
                        <div class="actions">
                            <button onclick="editProject(${i})" style="background:#00ff88;color:#000;">ویرایش</button>
                            <button onclick="deleteProject(${i})" style="background:#ff3366;">حذف</button>
                        </div>
                    </div>`;
            });
        }

        function editProject(i) {
            const p = projects[i];
            editingId = i;
            document.getElementById("pName").value = p.name;
            document.getElementById("pDesc").value = p.desc;
            document.getElementById("pImage").value = p.image;
            document.getElementById("pStatus").value = p.status;
            document.getElementById("submitBtn").textContent = "بروزرسانی پروژه";
        }

        function deleteProject(i) {
            if (confirm("واقعاً حذف بشه؟")) {
                projects.splice(i, 1);
                localStorage.setItem("vigigames_projects", JSON.stringify(projects));
                renderList();
            }
        }

        document.getElementById("projectForm").addEventListener("submit", function(e) {
            e.preventDefault();
            const newProj = {
                name: document.getElementById("pName").value.trim(),
                desc: document.getElementById("pDesc").value.trim(),
                image: document.getElementById("pImage").value.trim() || "https://placehold.co/800x600/111/00ffff?text=VIGIGAMES",
                status: document.getElementById("pStatus").value
            };

            if (editingId === null) projects.push(newProj);
            else { projects[editingId] = newProj; editingId = null; document.getElementById("submitBtn").textContent = "ثبت پروژه"; }

            localStorage.setItem("vigigames_projects", JSON.stringify(projects));
            renderList();
            document.getElementById("successMsg").textContent = "پروژه ثبت شد! حالا دانلود کن و آپلود کن.";
            setTimeout(() => document.getElementById("successMsg").textContent = "", 4000);
            e.target.reset();
        });
    </script>
</body>
</html>
